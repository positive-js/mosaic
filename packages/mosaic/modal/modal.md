Модальный диалог открывается окном поверх страницы, затемняет нижний слой и блокирует всякое взаимодействие с ним. Модальный диалог фокусирует внимание пользователя на своём содержании. 
<!-- example(modal-component) -->

### Когда использовать

Используйте модальные диалоги для решения краткосрочных задач, операций, вызванных пользователем (можно открыть короткую форму, настройки). Бывает удобно показать скрытый контент в модальном окне. Модалки помогают эффективно решать задачи без потери контекста основной страницы. Несмотря на универсальность, модальные окна подходят [не для всех ситуаций](/modal/overview#связанные-компоненты).

### Структура компонента

* Шапка. Заголовок диалога
* Действие «Закрыть»
* Тело. Содержит текст сообщения, вопрос, элементы управления и поля ввода
* Футер. Кнопки действий, возможность отменить операцию или закрыть диалог

Многих этих частей может не быть. Обязательно должно остаться тело и возможность закрыть диалог. Обязательный способ закрыть диалог — крестик в шапке или кнопка Отмена/Закрыть в футере.

#### Простой диалог без шапки

Похож на алерт браузера. Используйте, когда система задает один вопрос или сообщает короткую новость, когда ожидается избыточное дублирование текста в заголовке и теле модального окна. У таких диалогов в правом верхнем иглу нет иконки-крестика «Закрыть»
<!-- example(modal-overview) -->

### Описание работы

Страница затемняется, с ней нельзя взаимодействовать: нельзя нажимать кнопки, нет ховера, прокрутки и тп. Поверх затемнения открывается окно модального диалога.

Диалог может открыться по действию пользователя. После активации кнопки и тп. Система также может блокировать работу пользователя модальным диалогом. По возможности стоит избегать такого резкого вмешательства.


#### Как закрыть диалог

* Выполнение основного или второстепенных действий диалога (кнопки в футере)
* Кнопка Отмена< или Закрыть в футере
* Крестик в шапке, если без заголовка диалога никак
* Клик вне модального окна. По умолчанию модалку нельзя закрыть кликом вне окна, но такая опция должна быть доступна по требованию проектировщика. Полезно для окон с чисто информационным содержимым, где нет риска потери данных и где система не ждет явного ответа от пользователя (например, диалог да/нет с кнопкой отмена)
* Клавиша ESC ( эквивалентно действию Отмена)

Не стоит закрывать модальное окно автоматически по таймауту. Пользователь может не успеть изучить информацию внутри него

Иногда система не может позволить вернуться  к взаимодействию со страницей. Даже в этой ситуации модальное окно не должно быть тупиком в сценарии использования, надо предложить варианты действий. Например, если система показывает окно об истёкшей сессии, вернуться к странице на заднем фоне нельзя, нужно  предложить пройти на страницу логина и попытаться войти заново.

#### Запоминать данные пользователя

Если в окне были введены какие-то данные, запоминать их и заново показывать при повторном открытии диалога. Например, когда была попытка заполнить форму создания. Если была открыта форма редактирования в модалке, ее начали менять, но не сохранили, а закрыли. При повторном открытии не надо подставлять несохраненные данные.

#### Прокрутка

Задний фон страницы не прокручивается. Высота модального окна определяется содержимым. Окно растягивается по высоте и занимает всю доступную высоту экрана за вычетом отступов 48px по краям.

Прокручивается только центральная часть (тело) диалога. Шапка и футер остаются в видимой области. Они отбрасывают тень. Полоса прокрутки появляется внутри блока содержимого модального окна. Она должна быть прижата к правой границе окна, без отступа.

Длинная модалка — верный признак, что надо использовать [другой компонент или отдельную страницу](./modal/overview#связанные-компоненты). 
<!-- example(modal-scroll) -->

#### Фокус и работа с клавиатурой

При открытом модальном диалоге фокус перемещается только по элементам внутри окна включая крестик и кнопки в футере. Фокус не выходит за пределы.

##### Фокус при открытии модального диалога

Когда открывается диалог, фокус перемещается к элементу внутри диалога. Расположение фокуса зависит от характера и размера содержимого.

* Фокус устанавливается на первый доступный элемент внутри тела диалога, если нет особых предписаний
* Если в диалоге есть форма, то надо ставить фокус в первое поле ввода
* Если окно диалога содержит важное необратимое действие, то лучше поставить фокус на другое менее деструктивное. 
* Если в диалоге есть только терминальные кнопки, то будет полезно поставить фокус на кнопку, которую пользователь вероятнее всего нажмёт. OK или Отмена в зависимости от ситуации.
* Если внутри модального окна много контента, есть прокрутка, то установка фокуса на первый доступный элемент может автоматически промотать содержимое окна и убрать его начальные части из поля зрения. В этому случае надо добавить статическому элементу, расположенному начале контента, атрибут `tabindex=-1` и сфокусировать на нём. Этим элементом может быть заголовок, первый абзац и т. п.

##### Фокус после закрытия модального окна

Когда диалог закрывается, по умолчанию фокус возвращается на элемент, который вызвал его. 

Если триггеный элемент больше не существует, то фокус возвращается на другой элемент, подходящий логике взаимодействия

В некоторых ситуация фокус может специально возвращаться на другой элемент, не тот, что изначально открыл диалог

* маловероятно, что пользователь захочет сразу же открыть тот же диалог
* задача, выполненная в диалоговом окне, напрямую связана с последующим этапом рабочего процесса. Например, в таблице есть панель инструментов с кнопкой «Добавить строки». Кнопка открывает диалоговое окно и спрашивает количество новых строк. После закрытия диалога фокус помещается в первую ячейку первой новой строки. 

##### Управление с клавиатуры

| Клавиша | Действие |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span class="hot-key-Button">Ctrl</span> + <span class="hot-key-Button">↵</span>    | Выполняется основное действие диалога|
| <span class="hot-key-Button">Esc</span> | Закрыть диалог:<br>1. Если в диалоге не было изменения данных.<br>2. Если у элемента в фокусе нет собственного обработчика этой клавиши |
| <span class="hot-key-Button">↵</span> | Отправка формы по нажатию Enter в любом текстовом инпуте |

### Валидация

В теле окна может располагаться форма. Терминальные кнопки отправки формы должны располагаться в подвале окна. Валидация подчиняется общим правилам. 

### Дизайн и анимация

#### Положение

Окно открывается центру экрана с отступом 48px от верхней границы экрана. Если у страницы была прокрутка, то не должно быть сдвига по горизонтали, когда отрылся диалог. Часто это происходит, когда скроллбар появляется и исчезает при открытии или закрытии модалки. 

#### Размер

| Предустановка | Ширина |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Small   | 400 |
| Normal  | 640 по умолчанию |
| Large   | 960 |

В частности и никакой горизонтальной прокрутки в модальном окне также быть не должно.

<!-- example(modal-sizes) -->

#### Панель кнопок

Терминальные кнопки располагаются в правом нижнем углу в футере. Порядок: основное действие, второстепенное действие, отмена. Кнопки дополнительных действий располагаются в левом нижнем углу.


<font color="red">__Тут нужна одна кнопка которая будет отрывать c тремя кнопками [ВОТ МАКЕТ](https://www.figma.com/file/xDLkQRzr7g0RVrj8A0676E/Guide-patterns?node-id=11590%3A29036)__</font>


#### Наложение модальных окон

Открывать один модальный диалог из другого неправильно. Но если вдруг пришлось (экономия, вынужденная мера), то надо оставлять всего одно затемнение. А под ним уже располагать фон страницы и родительскую модалку. Делать несколько затемнений — ошибка.

<font color="red">__Тут нужна одна кнопка которая будет отрывать уже открытое окно на котором открыто еще одно окно [как вот тут](https://wiki.ptsecurity.com/pages/viewpage.action?pageId=96272601&preview=/96272601/96273467/mc-modal-overlap.png)__</font>

### Доступность. Роли, состояния и атрибуты WAI-ARIA

* Элемент-контейнер диалога должен иметь роль `dialog`
* Все элементы, необходимые для работы с диалогом, являются потомками элемента с ролью `dialog`
* Элементу-контейнеру диалога указан атрибут `aria-modal=true`
* Диалог имеет
    * Свойства `aria-labelledby` ссылается на видимый заголовок диалога.
    * Название, определенной атрибутом `aria-label`
* Опционально. Атрибут `aria-describedby` устанавливается для элемента с ролью `dialog`, чтобы указать, какие элементы в диалоге содержат контент, который описывает основную цель или сообщение диалога. Это даёт возможность скринридерам объявлять описание вместе с заголовком диалога и первоначально сфокусированным элементом при открытии диалога.

### Связанные компоненты

Модальный диалог резко концентрирует на себе, заставляет терять фокус внимания, не дает взаимодействовать со станицей под ним. Поэтому в большинстве случаев нужно попытаться избежать модальности. Эти приёмы помогут бережно обойтись с пользователем и избежать наслоения модальных окон:

[Поповер](/popover) менее деструктивно перехватывает внимания пользователя. Он не мешают взаимодействовать с остальной частью страницы, не ограничивают свободу. Поповер легче закрыть случайно. Если система ждет важный ответ, или неочевидно, какое действие произойдет, если закрыть поповер, то используйте старый добрый модальный диалог. 

[Боковая панель](/sidepanel) — что-то среднее между новой страницей и модальным окном. Она растянута по высоте на 100% окна браузера, и длинные и узкие страницы в ней выглядят лучше, чем в модальном окне, а широкие и невысокие хуже. Боковая панель отлично справляется с наложением одной на другую, а модальные окна так не стоит использовать с наслоением.

**Инлайн-сообщение и инлайн-форма** помогают показать новый контент на том же слое страницы и делают это менее раздражительно. Приём активно используется для вывода ошибок ко всей форме, или чтобы заранее предупредить пользователя о чем-то важном. Инлайн-формы помогают избежать модальных режимов, новых экранов, вложенности на сложных формах. Например, когда надо добавить в коллекцию новый объект из нескольких полей (имя, фамилия, отчество)

**Аккордеон**, прием «Показать ещё», [тултип](/tooltip) помогут, когда надо всего лишь показать дополнительный контент. Этот приём подойдет для менее важных вещей, чем при использовании инлайн-сообщений

Тост-уведомление на короткое время сообщит о результате операции или покажет совсем неважное сообщение. Тост-уведомления используется, когда нестрашно, если человек пропустит сообщение, когда сообщение может быстро потерять актуальность или есть другая возможность прочитать его. Например, в центре уведомлений. 

**Новая страница** приходит на замену модальному окну, когда нужно показать много контента, длинную форму или список. Такой способ поможет полноценно представить контент, сфокусировать на нем без потери функциональности. Например, навигации. 

**Приём «Отменить изменения»**. Вместо модального диалога «Вы уверены?», часто лучше сразу выполнить операцию и дать возможность ее отменить.